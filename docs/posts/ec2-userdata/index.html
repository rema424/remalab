<!doctype html><html lang=ja-jp data-theme><head><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-N95L2VD');</script><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>EC2のデフォルトユーザー(ec2-user)とデフォルトSSHポートの変更をユーザーデータで自動化する - RemaLab</title><meta name=description content="EC2のデフォルトユーザー(ec2-user)とデフォルトSSHポートの変更をユーザーデータで自動化する方法を確認します。"><link rel=icon type=image/x-icon href=https://rema424.github.io/remalab/favicon.ico><link rel=apple-touch-icon-precomposed href=https://rema424.github.io/remalab/favicon.png><link rel=stylesheet href=https://rema424.github.io/remalab/css/style.min.9aff271207ab9adf80eba2147d0c7fecd4fee20373798aff107adfef419fc680.css integrity="sha256-mv8nEgermt+A66IUfQx/7NT+4gNzeYr/EHrf70GfxoA="><link rel=stylesheet href="https://rema424.github.io/remalab/css/main.css?rnd=1605852834"><meta property="og:title" content="EC2のデフォルトユーザー(ec2-user)とデフォルトSSHポートの変更をユーザーデータで自動化する"><meta property="og:description" content="EC2のデフォルトユーザー(ec2-user)とデフォルトSSHポートの変更をユーザーデータで自動化する方法を確認します。"><meta property="og:type" content="article"><meta property="og:url" content="https://rema424.github.io/remalab/posts/ec2-userdata/"><meta property="article:published_time" content="2020-11-20T15:00:27+09:00"><meta property="article:modified_time" content="2020-11-20T15:00:27+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="EC2のデフォルトユーザー(ec2-user)とデフォルトSSHポートの変更をユーザーデータで自動化する"><meta name=twitter:description content="EC2のデフォルトユーザー(ec2-user)とデフォルトSSHポートの変更をユーザーデータで自動化する方法を確認します。"></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N95L2VD" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><h1 class=site-title><a href=/remalab>RemaLab</a></h1><nav></nav></header><main id=main tabindex=-1><article class=post><header class=post-header><h1 class=post-title>EC2のデフォルトユーザー(ec2-user)とデフォルトSSHポートの変更をユーザーデータで自動化する</h1></header><div class=content><p>EC2の起動時のオプションにユーザーデータという項目があります。
こちらを利用すると立ち上げ時のOS内部の設定を変更できます。
例えばEC2ではデフォルトでec2-userという名称のユーザーが作られますが、このデフォルトユーザーを任意の名称に変更することも可能です。</p><p>今回は例として「デフォルトユーザーの名称変更」と「SSHポートの変更」をやってみます。</p><p>と言ってもやることは簡単で、EC2起動時の項目に「ユーザーデータ」というのがあるのでそこに以下のyaml形式のテキストを入力して立ち上げるだけです。</p><p>以下の <code>&lt;username></code> は任意のユーザー名で置き換えます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e>#cloud-config</span>
<span style=color:#f92672>timezone</span>: <span style=color:#ae81ff>Asia/Tokyo</span>
<span style=color:#f92672>users</span>:
  - <span style=color:#ae81ff>default</span>
<span style=color:#f92672>runcmd</span>:
  - <span style=color:#e6db74>&#39;/bin/sed -i&#34;.org&#34; --follow-symlinks -e &#34;s/#Port 22/Port 10022/&#34; /etc/ssh/sshd_config&#39;</span>
  - <span style=color:#e6db74>&#39;systemctl restart sshd.service&#39;</span>
<span style=color:#f92672>system_info</span>:
  <span style=color:#f92672>default_user</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>&lt;username&gt;</span>
</code></pre></div><p>以下のコマンドでSSHログインします。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>ssh -i &lt;path-to-key&gt; &lt;username&gt;@&lt;hostname&gt; -p <span style=color:#ae81ff>10022</span>
</code></pre></div></div><div class=post-info><div class=post-date>2020-11-20</div><div class=post-taxonomies></div></div></article></main><footer class=common-footer><div class=common-footer-bottom><ul class=footer-menu><li><a href=https://rema424.github.io/remalab/info/privacy/ title=プライバシーポリシー>プライバシーポリシー</a></li></ul><div class=copyright><p>© rema, 2020<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.</p></div></div></footer></div></body></html>